<%- contentFor('body') %>
<div class="admin-complaints-container">
    <h1 class="page-title">Manage Complaints</h1>
    
    <% if (locals.error) { %>
        <div class="alert alert-danger">
            <div class="alert-icon">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <div class="alert-content">
                <%= error %>
            </div>
        </div>
    <% } %>
    
    <% if (complaints && complaints.length > 0) { %>
        <div class="complaints-table-container">
            <table class="complaints-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Location</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Submitted</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% complaints.forEach(complaint => { %>
                        <tr>
                            <td><%= complaint._id.toString().substring(0, 8) %></td>
                            <td><%= complaint.title %></td>
                            <td><%= complaint.category %></td>
                            <td><%= complaint.location %></td>
                            <td>
                                <span class="priority-badge priority-<%= complaint.priority %>">
                                    <%= complaint.priority %>
                                </span>
                            </td>
                            <td>
                                <span class="status-badge status-<%= complaint.status.toLowerCase() %>">
                                    <%= complaint.status %>
                                </span>
                            </td>
                            <td><%= new Date(complaint.createdAt).toLocaleDateString() %></td>
                            <td>
                                <a href="/complaint/<%= complaint._id %>" class="btn btn-sm btn-info">View</a>
                                <button class="btn btn-sm btn-primary update-status-btn" 
                                        data-complaint-id="<%= complaint._id %>"
                                        data-current-status="<%= complaint.status %>">
                                    Update
                                </button>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    <% } else { %>
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <h3>No Complaints Found</h3>
            <p>There are no complaints in the system at this time.</p>
        </div>
    <% } %>
</div>

<!-- Status Update Modal -->
<div class="modal" id="statusModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Update Complaint Status</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="updateStatusForm" action="/update-complaint-status" method="POST">
                <input type="hidden" id="complaintId" name="complaintId">
                
                <div class="form-group">
                    <label for="status">New Status</label>
                    <select id="status" name="status" class="form-control" required>
                        <option value="PENDING">Pending</option>
                        <option value="PROCESSING">Processing</option>
                        <option value="RESOLVED">Resolved</option>
                        <option value="REJECTED">Rejected</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="comment">Comment (Optional)</label>
                    <textarea id="comment" name="comment" class="form-control" rows="3" 
                              placeholder="Add a comment about this status change"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelUpdate">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Status</button>
                </div>
            </form>
        </div>
    </div>
</div>

<%- contentFor('style') %>
<style>
    .admin-complaints-container {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .page-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 2rem;
        color: var(--text-color);
        text-align: center;
    }
    
    .complaints-table-container {
        overflow-x: auto;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        margin-bottom: 2rem;
    }
    
    .complaints-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .complaints-table th,
    .complaints-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #eee;
    }
    
    .complaints-table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: var(--text-color);
    }
    
    .complaints-table tr:hover {
        background-color: #f8f9fa;
    }
    
    .priority-badge,
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: capitalize;
    }
    
    .priority-low {
        background-color: #e9f7ef;
        color: #27ae60;
    }
    
    .priority-medium {
        background-color: #fef9e7;
        color: #f39c12;
    }
    
    .priority-high {
        background-color: #fdedec;
        color: #e74c3c;
    }
    
    .status-pending {
        background-color: #fef9e7;
        color: #f39c12;
    }
    
    .status-processing {
        background-color: #eaf2f8;
        color: #3498db;
    }
    
    .status-resolved {
        background-color: #e9f7ef;
        color: #27ae60;
    }
    
    .status-rejected {
        background-color: #fdedec;
        color: #e74c3c;
    }
    
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
    }
    
    .empty-icon {
        font-size: 3rem;
        color: #ddd;
        margin-bottom: 1rem;
    }
    
    .empty-state h3 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-color);
    }
    
    .empty-state p {
        color: var(--text-muted);
    }
    
    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }
    
    .modal.active {
        display: flex;
    }
    
    .modal-content {
        background: white;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
        padding: 1rem;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header h2 {
        margin: 0;
        font-size: 1.5rem;
        color: var(--text-color);
    }
    
    .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-muted);
    }
    
    .modal-body {
        padding: 1.5rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-color);
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
        font-size: 1rem;
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 1.5rem;
    }
    
    @media (max-width: 768px) {
        .complaints-table th:nth-child(3),
        .complaints-table td:nth-child(3),
        .complaints-table th:nth-child(4),
        .complaints-table td:nth-child(4) {
            display: none;
        }
    }
</style>

<%- contentFor('script') %>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('statusModal');
        const updateButtons = document.querySelectorAll('.update-status-btn');
        const closeModal = document.querySelector('.close-modal');
        const cancelButton = document.getElementById('cancelUpdate');
        const statusSelect = document.getElementById('status');
        const complaintIdInput = document.getElementById('complaintId');
        
        // Open modal when update button is clicked
        updateButtons.forEach(button => {
            button.addEventListener('click', function() {
                const complaintId = this.getAttribute('data-complaint-id');
                const currentStatus = this.getAttribute('data-current-status');
                
                complaintIdInput.value = complaintId;
                statusSelect.value = currentStatus;
                
                modal.classList.add('active');
            });
        });
        
        // Close modal when close button or cancel button is clicked
        closeModal.addEventListener('click', closeModalHandler);
        cancelButton.addEventListener('click', closeModalHandler);
        
        function closeModalHandler() {
            modal.classList.remove('active');
        }
        
        // Close modal when clicking outside the modal content
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModalHandler();
            }
        });
    });
</script> 